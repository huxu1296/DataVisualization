(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-69b7b7e7"],{"31d9":function(t,e,o){"use strict";o.r(e);o("6d95"),o("6823");var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"salary-box"},[e("div",{staticClass:"filter-panel"},[e("div",{staticClass:"filter-row"},[e("div",{staticClass:"filter-group"},[e("label",[t._v("职位代码:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedJobCode,expression:"selectedJobCode"}],staticClass:"filter-select",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedJobCode=e.target.multiple?o:o[0]}}},[e("option",{attrs:{value:""}},[t._v("选择职位代码")]),t._l(t.jobCodeOptions,(function(o,i){return e("option",{key:"code-"+i,domProps:{value:o.code}},[t._v(" "+t._s(o.code)+" - "+t._s(t.truncateText(o.title,8))+" ")])}))],2)]),e("div",{staticClass:"filter-group"},[e("label",[t._v("推荐职位:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedRecommendedJob,expression:"selectedRecommendedJob"}],staticClass:"filter-select",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedRecommendedJob=e.target.multiple?o:o[0]}}},[e("option",{attrs:{value:""}},[t._v("选择推荐职位")]),t._l(t.recommendedJobs,(function(o,i){return e("option",{key:"rec-"+i,domProps:{value:o.title}},[t._v(" "+t._s(t.truncateText(o.title,12))+" ")])}))],2)])]),e("div",{staticClass:"filter-row"},[e("div",{staticClass:"filter-group"},[e("label",[t._v("城市筛选:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedCity,expression:"selectedCity"}],staticClass:"filter-select",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedCity=e.target.multiple?o:o[0]}}},[e("option",{attrs:{value:""}},[t._v("全部城市")]),t._l(t.cityOptions,(function(o,i){return e("option",{key:"city-"+i,domProps:{value:o}},[t._v(" "+t._s(o)+" ")])}))],2)]),e("button",{staticClass:"filter-button",on:{click:t.updateChart}},[t._v("更新图表")])])]),e("div",{ref:"chartContainer",staticClass:"chart-container"}),t.noDataWarning?e("div",{staticClass:"no-data-warning"},[t._v(" "+t._s(t.noDataWarning)+" ")]):t._e()])},s=[],a=(o("25c1"),o("a6b6"),o("378e"),o("10ab"),o("9fde"),o("c85b"),o("d10e"),o("97a1"),o("f8c9"),o("6213"),o("edf1"),o("ada4")),l={name:"SalaryBox",props:{data:{type:Object,default:()=>({})}},data(){return{myChart:null,selectedJobCode:"",selectedRecommendedJob:"",selectedCity:"",noDataWarning:"",jobCodeOptions:[],recommendedJobs:[],cityOptions:[],displayedJobs:[],defaultColors:["#2ca8fe","#a262f2","#feed2c","#c0232a","#fe672c","#40798c"]}},methods:{truncateText(t,e){return t?t.length>e?t.substring(0,e)+"...":t:""},updateChart(){this.noDataWarning="";const t={jobCode:this.selectedJobCode,recommendedJob:this.selectedRecommendedJob,city:this.selectedCity};console.log("应用筛选条件:",t),this.getFilteredJobData(t),this.$nextTick(()=>{this.renderBoxplot()})},getFilteredJobData(t){const e=this.data&&this.data.jobProfiles?[...this.data.jobProfiles]:[];if(0===e.length)return console.warn("没有可用的职位数据"),void(this.noDataWarning="暂无职位数据，请确保Excel文件已正确加载");if(this.displayedJobs=[],t.jobCode){const e=this.findJobByCode(t.jobCode);e&&this.displayedJobs.push({...e,boxplotData:this.calculateBoxplotData(e,t.city)})}else if(t.recommendedJob){const o=e.find(e=>e.title===t.recommendedJob);o&&this.displayedJobs.push({...o,boxplotData:this.calculateBoxplotData(o,t.city)})}else{const o=[...e].sort((t,e)=>e.count-t.count).slice(0,5);this.displayedJobs=o.map(e=>({...e,boxplotData:this.calculateBoxplotData(e,t.city)}))}0===this.displayedJobs.length&&(this.noDataWarning="未找到满足条件的职位数据"),console.log("筛选后的职位数据:",this.displayedJobs)},findJobByCode(t){const e=this.data&&this.data.jobProfiles?[...this.data.jobProfiles]:[],o=this.jobCodeOptions.find(e=>e.code===t);return o&&o.title?e.find(t=>t.title===o.title):null},calculateBoxplotData(t,e){if(!t)return[0,0,0,0,0];let o=[];return o=e&&t.citySalaries&&t.citySalaries[e]?t.citySalaries[e]:t.salaries||[],this.calculateBoxplotFromSalaries(o)},calculateBoxplotFromSalaries(t){if(!t||!t.length)return console.log("没有薪资数据"),[0,0,0,0,0];const e=this.parseSalariesToValues(t);if(0===e.length)return console.log("没有有效的薪资值"),[0,0,0,0,0];e.sort((t,e)=>t-e);const o=e[0],i=e[e.length-1];let s,a,l;if(1===e.length)s=a=l=o;else{const t=Math.floor(.25*e.length),o=Math.floor(.5*e.length),i=Math.floor(.75*e.length);s=e[t],a=e[o],l=e[i]}const n=[o,s,a,l,i];return console.log("计算的箱线图数据:",n),n},parseSalariesToValues(t){const e=[];return t.forEach(t=>{const o=String(t);let i=o.match(/(\d+)(?:k|K)?(?:\s*[-~]\s*)(\d+)(?:k|K)?/i);if(i){const t=parseInt(i[1]),o=parseInt(i[2]),s=(t+o)/2;e.push(s)}else i=o.match(/^(\d+)(?:k|K)$/i),i?e.push(parseInt(i[1])):(i=o.match(/^(\d+)$/),i&&e.push(parseInt(i[1])))}),e},renderBoxplot(){if(!this.myChart){if(!this.$refs.chartContainer)return void console.warn("找不到图表容器元素");this.myChart=a["init"](this.$refs.chartContainer)}if(0===this.displayedJobs.length)return void this.myChart.setOption({title:{text:"职位薪资箱线图分析",textStyle:{color:"#75deef",fontSize:14},left:"center",top:10},grid:{left:"10%",right:"10%",top:"15%",bottom:"15%"},xAxis:{type:"category",data:[],axisLabel:{color:"#75deef"}},yAxis:{type:"value",name:"薪资 (K/月)",axisLabel:{formatter:"{value}K",color:"#75deef"}},series:[]});const t=this.displayedJobs.map(t=>t.title),e=this.displayedJobs.map(t=>t.boxplotData),o=e.map((t,e)=>[e,t[2]]),i=t.map(t=>t.substring(0,5));let s="职位薪资箱线图分析",l="";l=this.selectedCity?this.selectedCity+"地区":"全部地区";const n={title:{text:s,subtext:l,textStyle:{color:"#75deef",fontSize:14},subtextStyle:{color:"#6dd0e3",fontSize:12},left:"center",top:5},tooltip:{trigger:"item",backgroundColor:"#11367a",textStyle:{color:"#6dd0e3"},formatter:e=>{if(0===e.seriesIndex){const o=e.value,i=t[e.dataIndex]||e.name,s=this.selectedCity||"全部地区",a=o[3]-o[1];return[`<div style="font-weight:bold;margin-bottom:3px;">${i}</div>`,`<div style="font-size:12px;margin-bottom:3px;">${s}</div>`,`最大值: ${o[4]}K`,`上四分位: ${o[3]}K`,`<span style="font-weight:bold">中位数: ${o[2]}K</span>`,`下四分位: ${o[1]}K`,`最小值: ${o[0]}K`,'<div style="margin-top:3px;font-style:italic;border-top:1px solid rgba(255,255,255,0.2);padding-top:3px;">',`四分位距: ${a.toFixed(1)}K`,`薪资范围: ${o[4]-o[0]}K`,"</div>"].join("<br/>")}return e.name+": "+e.value+"K"},axisPointer:{type:"shadow"}},grid:{left:"10%",right:"10%",top:"20%",bottom:"15%"},xAxis:{type:"category",data:i,boundaryGap:!0,nameGap:30,axisLine:{lineStyle:{color:"#1a3c58"}},axisLabel:{color:"#75deef",fontSize:12,interval:0,formatter:function(t){return t.split("").join("\n")}},splitLine:{show:!1}},yAxis:{type:"value",name:"薪资 (K/月)",min:0,nameTextStyle:{color:"#75deef",fontSize:12},axisLabel:{formatter:"{value}K",color:"#75deef"},axisLine:{lineStyle:{color:"#1a3c58"}},splitLine:{lineStyle:{color:"rgba(26,60,88,0.3)"}}},series:[{name:"职位薪资分布",type:"boxplot",data:e,itemStyle:{color:t=>this.defaultColors[t.dataIndex%this.defaultColors.length],borderColor:t=>this.defaultColors[t.dataIndex%this.defaultColors.length]},emphasis:{itemStyle:{borderWidth:2,shadowBlur:10,shadowColor:"rgba(44, 168, 254, 0.5)"}}},{name:"中位数薪资",type:"scatter",symbolSize:8,data:o,itemStyle:{color:"#feed2c",borderColor:"#fff",borderWidth:1},label:{show:!0,position:"top",formatter:"{c}K",color:"#feed2c",fontSize:10}}]};this.myChart.setOption(n,!0),this.myChart.resize(),this.myChart.off("click"),this.myChart.on("click",e=>{if("xAxis"===e.componentType&&t[e.dataIndex]){const o=t[e.dataIndex];console.log("选择了职位:",o),this.displayedJobs=this.displayedJobs.filter(t=>t.title===o),this.renderBoxplot(),this.$emit("job-selected",o)}})},initialize(){this.noDataWarning="";const t=this.data&&this.data.jobProfiles?this.data.jobProfiles:[];0!==t.length?(this.initCityOptions(t),this.initJobCodeOptions(t),this.initRecommendedJobs(t),this.getFilteredJobData({jobCode:"",recommendedJob:"",city:""}),this.$nextTick(()=>{this.renderBoxplot()})):this.noDataWarning="未找到职位数据，请确保Excel文件已正确加载"},initCityOptions(t){const e=new Set;t.forEach(t=>{t.topCities&&t.topCities.length>0&&t.topCities.forEach(t=>{t.city&&e.add(t.city)})}),this.cityOptions=[...e].sort(),console.log("初始化城市选项:",this.cityOptions)},initJobCodeOptions(t){this.jobCodeOptions=t.map((t,e)=>{let o="JB";const i=t.title;i.includes("前端")?o="FE":i.includes("后端")?o="BE":i.includes("全栈")?o="FS":i.includes("数据")?o="DA":i.includes("设计")?o="UI":i.includes("产品")?o="PM":i.includes("测试")&&(o="QA");const s=(e+1).toString().padStart(3,"0");return{code:o+s,title:t.title}}),console.log("初始化职位代码选项:",this.jobCodeOptions)},initRecommendedJobs(t){this.recommendedJobs=[...t].sort((t,e)=>parseFloat(e.avgSalary)-parseFloat(t.avgSalary)).slice(0,5).map(t=>({title:t.title,avgSalary:t.avgSalary})),console.log("初始化推荐职位:",this.recommendedJobs)},handleResize(){this.myChart&&this.myChart.resize()},setChart(){this.initialize()}},watch:{"data.jobProfiles":{handler(t){t&&t.length>0&&(console.log("职位数据更新，重新初始化箱线图，共",t.length,"个职位"),this.initialize())},immediate:!0}},mounted(){this.$nextTick(()=>{this.initialize()}),this.handleResize=this.handleResize.bind(this),window.addEventListener("resize",this.handleResize)},beforeDestroy(){window.removeEventListener("resize",this.handleResize),this.myChart&&(this.myChart.dispose(),this.myChart=null)}},n=l,r=(o("db37"),o("1805")),d=Object(r["a"])(n,i,s,!1,null,"39cd4930",null);e["default"]=d.exports},"3e01":function(t,e,o){},db37:function(t,e,o){"use strict";o("3e01")}}]);
//# sourceMappingURL=chunk-69b7b7e7.20ee762c.js.map